---
title: "Distribution Exploration"
output:
  html_document:
    df_print: paged
---

## Exploring distributions and related probability concepts {.tabset}

```{r INITIAL, include=FALSE}
knitr::opts_chunk$set(echo=FALSE,
                      message=FALSE,
                      warning=FALSE)

library(tidyverse)
library(lubridate)
library(scales)

```

### Normal

Key concepts, using the Normal distribution as a starting point.

#### Generate Normal Distribution

Generate a random set of numbers that follow a specified normal distribution.

```{r GENERATE NORMAL}

m <- 50
std <- 10
norm_01 <- rnorm(n=1000, mean=m, sd=std)
```

Normal distribution with:

* Mean: `r m` 
* Std. deviation: `r std`

```{r VIEW NORMAL}

plot(norm_01)
hist(norm_01)
boxplot(norm_01)

```

Convert to data frame use with ggplot and additional features therein. Get summary statistics.

```{r NORM DATA FRAME}
df_norm_01 <- data.frame(values=norm_01)

summary(df_norm_01)
print(paste0('Std dev: ', sd(df_norm_01$values)))
```

```{r NORM GGPLOT 1}

ggplot(df_norm_01, aes(x=values))+geom_histogram(fill='grey')+
  geom_vline(xintercept = mean(df_norm_01$values), color='green', linetype='dashed', size=1)+
  geom_vline(xintercept = median(df_norm_01$values), color='blue', linetype='dotted')+
  geom_vline(xintercept=quantile(df_norm_01$values, 0.25), color='purple')+
  geom_vline(xintercept = quantile(df_norm_01$values, 0.75), color='purple')+
  geom_vline(xintercept=mean(df_norm_01$values)-sd(df_norm_01$values), color='orange')+
  geom_vline(xintercept=mean(df_norm_01$values)+sd(df_norm_01$values), color='orange')+
  scale_y_continuous(expand=c(0,0))+
  scale_x_continuous(expand=c(0,0))+
  theme_classic()
```

* Green = mean
* Blue = median
* Purple = 25th and 75th percentiles
* Orange = 1 std dev, above and below mean

Convert histogram to density function, with probabilities on y-axis:

```{r}
df_norm_01 <- df_norm_01 %>% mutate(
  prob=dnorm(values, mean=m, sd=std)
)

ggplot(df_norm_01, aes(x=values, y=prob))+geom_line()+
  geom_vline(xintercept = mean(df_norm_01$values), color='green', linetype='dashed', size=1)+
  geom_vline(xintercept = median(df_norm_01$values), color='blue', linetype='dotted')+
  geom_vline(xintercept=quantile(df_norm_01$values, 0.25), color='purple')+
  geom_vline(xintercept = quantile(df_norm_01$values, 0.75), color='purple')+
  geom_vline(xintercept=mean(df_norm_01$values)-sd(df_norm_01$values), color='orange')+
  geom_vline(xintercept=mean(df_norm_01$values)+sd(df_norm_01$values), color='orange')+
  scale_y_continuous(labels=percent)+
  theme_classic()

```

Plot the cumulative distrbution function for this data:

* can be read as cumulative percentiles on the left

```{r}
plot(ecdf(df_norm_01$values))
```

Can create the same by applying pnorm() to the data and drawing with ggplot2:

```{r}
df_norm_01 <- df_norm_01 %>% mutate(
  pctl = pnorm(values, mean=m, sd=std)
)

ggplot(df_norm_01, aes(x=values, y=pctl))+geom_line()+
  geom_vline(xintercept = mean(df_norm_01$values), color='green', linetype='dashed', size=1)+
  geom_vline(xintercept = median(df_norm_01$values), color='blue', linetype='dotted')+
  geom_vline(xintercept=quantile(df_norm_01$values, 0.25), color='purple')+
  geom_vline(xintercept = quantile(df_norm_01$values, 0.75), color='purple')+
  geom_vline(xintercept=mean(df_norm_01$values)-sd(df_norm_01$values), color='orange')+
  geom_vline(xintercept=mean(df_norm_01$values)+sd(df_norm_01$values), color='orange')+
  scale_x_continuous(expand=c(0,0))+
  scale_y_continuous(labels=percent, expand=c(0,0), limits=c(0,1))+
  theme_classic()

```

#### Probabilities

What is the probability of value X as an outcome?

```{r PROB 1}
options(scipen = 99)
x <- 40
dnorm(x=x, mean=m, sd=std)

```

A single number in a continous distribution, so the probability will be low.

What is the probability of an outcome of X or lower?

```{r PROB 2}
x <- mean(df_norm_01$values)-sd(df_norm_01$values)
pnorm(q=x, mean=m, sd=std)

```

what is the probability of an outcome between X and Y?

```{r PROB 3}
x <- x
y <- mean(df_norm_01$values)+sd(df_norm_01$values)
p_lower <- pnorm(q=x, mean=m, sd=std)
p_upper <- pnorm(q=y, mean=m, sd=std, lower.tail=FALSE)
pxy <- 1-(p_lower+p_upper)

```

Probability of an outcome between `r x` and `r y` is: `r pxy`.

### Gamma distribution

Gamma is actually a family of distributions. It seems to offer better replication of skewed distributions than Poisson.

From <https://www.rocscience.com/help/swedge/swedge/Gamma_Distribution.htm>:

* The Gamma distribution is widely used in engineering, science, and business, to model continuous variables that are always positive and have skewed distributions.
* a (alpha) is known as the shape parameter, while b (beta) is referred to as the scale parameter.
* b has the effect of stretching or compressing the range of the Gamma distribution. A Gamma distribution with b = 1 is known as the standard Gamma distribution.

The Gamma distribution represents a family of shapes. As suggested by its name, a controls the shape of the family of distributions. The fundamental shapes are characterized by the following values of a:

Case I (a < 1)

* When a < 1, the Gamma distribution is exponentially shaped and asymptotic to both the vertical and horizontal axes.

Case II (a = 1)

* Gamma distribution with shape parameter a = 1 and scale parameter b is the same as an exponential distribution of scale parameter (or mean) b.

Case III (a > 1)

* When a is greater than one, Gamma distribution assumes a mounded (unimodal), skewed shape. Skewness reduces as the value of a increases.

There are two parameters and two variations on the parameter combinations. For simplicity, focus here is on:

* shape (a above, sometimes k) -> determines skew
* scale (b above, sometimes theta) -> determines stretch/compression of the range 

Some gamma distribution examples:

*(still can't figure out how some combinations of shape and scale yield a density of >1 at 0)*

```{r GAMMA DIST}

## function to create gamma samples and density
fGammavardens <- function(num, sh, sc){
  shsc <- paste0('gamma','-',sh,':', sc)
  cat(paste0('shape=',sh,' rate=', sc))
  datagam <- rgamma(n=1000, shape=sh, scale=sc)
  plot.hist <- hist(datagam)
  #plot.hist <- ggplot(data.frame(datagam), aes(x=datagam))+geom_histogram()
  
  datagam <- round(datagam, 3)
  datagam <- unique(datagam)
  dengam <- dgamma(datagam, shape=sh, scale=sc)
  gam <- data.frame(datagam, dengam, ksc=shsc)
  plot.dense <- plot(data=gam, dengam~datagam)
  #plot.dense <- ggplot(gam, aes(x=datagam, y=dengam))+geom_line()+theme_classic()
  
  list(plot.hist, plot.dense)
  return(gam)
}

gam_all <- data.frame()

gamsample <- fGammavardens(1000, 1, 0.5)
gam_all <- bind_rows(gam_all, gamsample)

gamsample <- fGammavardens(1000, 1, 1)
gam_all <- bind_rows(gam_all, gamsample)

gamsample <- fGammavardens(1000, 1, 2)
gam_all <- bind_rows(gam_all, gamsample)

gamsample <- fGammavardens(1000, 2, 0.5)
gam_all <- bind_rows(gam_all, gamsample)

gamsample <- fGammavardens(1000, 2, 2)
gam_all <- bind_rows(gam_all, gamsample)

gamsample <- fGammavardens(1000, 3, 0.5)
gam_all <- bind_rows(gam_all, gamsample)

gamsample <- fGammavardens(1000, 3, 1)
gam_all <- bind_rows(gam_all, gamsample)

gamsample <- fGammavardens(1000, 5, 1)
gam_all <- bind_rows(gam_all, gamsample)


gam_all <- gam_all %>% distinct(datagam, .keep_all = TRUE)
ggplot(gam_all, aes(x=datagam, y=dengam, color=ksc))+
  geom_line()

```

